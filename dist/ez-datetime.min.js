angular.module("ez.datetime",[]),angular.module("ez.datetime").constant("EzDatetimeConfig",{isUtc:!1,minView:"day",startView:"day",modelFormat:void 0,viewFormat:"MMM Do YYYY [at] h:mma",timepickerEnabled:!0,secondsEnabled:!1,meridiemEnabled:!0,hourFormat:"h",minuteFormat:"mm",secondFormat:"ss",meridiemFormat:"A",headingText:"Select a Date",rangeHeadingText:"Select a Start & End Date",okBtnText:"Ok",cancelBtnText:"Cancel",shortcutBtnText:"Shortcuts",noValueText:"No date selected",okBtnIcon:"glyphicon glyphicon-ok",cancelBtnIcon:"glyphicon glyphicon-remove",shortcutBtnIcon:"glyphicon glyphicon-flash",clearBtnIcon:"glyphicon glyphicon-trash",headingIcon:"glyphicon glyphicon-calendar",shortcutsEnabled:!0,shortcutAsValue:!1,shortcutNamePrefix:"",shortcuts:[{id:"today",name:"Today",from:moment().startOf("day"),to:moment().endOf("day")},{id:"tomorrow",name:"Tomorrow",from:moment().add(1,"days").startOf("day"),to:moment().add(1,"days").endOf("day")},{id:"yesterday",name:"Yesterday",from:moment().subtract(1,"days").startOf("day"),to:moment().subtract(1,"days").endOf("day")},{id:"this_week",name:"This Week",from:moment().startOf("week"),to:moment().endOf("week")},{id:"next_week",name:"Next Week",from:moment().add(1,"week").startOf("week"),to:moment().add(1,"week").endOf("week")},{id:"last_week",name:"Last Week",from:moment().subtract(1,"week").startOf("week"),to:moment().subtract(1,"week").endOf("week")},{id:"this_month",name:"This Month",from:moment().startOf("month"),to:moment().endOf("month")},{id:"next_month",name:"Next Month",from:moment().add(1,"month").startOf("month"),to:moment().add(1,"month").endOf("month")},{id:"last_month",name:"Last Month",from:moment().subtract(1,"month").startOf("month"),to:moment().subtract(1,"month").endOf("month")},{id:"this_year",name:"This Year",from:moment().startOf("year"),to:moment().endOf("year")}]}),angular.module("ez.datetime").controller("EzDatetimeModalController",["$scope","$uibModalInstance",function(a,b){var c,d,e;a.shortcuts=[],a.options.shortcuts.forEach(function(b){a.form.min&&(c=moment(a.form.minDate),b.from<c||b.to<c)||a.form.max&&(d=moment(a.form.maxDate),b.from>d||b.to>d)||a.shortcuts.push(b)}),a.select=function(b){e=a.$parent.options.shortcuts[b],a.form.shortcut=e.id,a.form.shortcutName=e.name,e.from?a.form.from=e.from.format():a.form.from=null,e.to?a.form.to=e.to.format():a.form.to=null},a.dismiss=function(){b.dismiss()},a.ok=function(){b.close()}}]),angular.module("ez.datetime").directive("ezDatePicker",["EzDatetimeService",function(a){return{restrict:"EA",require:"ngModel",templateUrl:"ez_datetime_date_picker.html",scope:{minDate:"=?",maxDate:"=?",from:"=?",to:"=?",options:"=?"},replace:!0,link:function(b,c,d,e){b.date=null,a.resolveConfig(b,d);var f=function(a){var b=10*parseInt(moment(a).year()/10,10);return moment(a).year(b).startOf("year")},g=function(a){return a?(moment.isMoment(a)||("x"===b.options.modelFormat&&(a=parseInt(a,10)),a=moment(a)),a):void 0},h=function(a,c,d){var e=a.unix();d.highlight=!1,d.unselectable=!1;var f="setValue"===b.view?b.options.minView:b.view,h=b.minDate||b.from;if(h){var i=g(h).startOf(f).unix();i>e&&(d.unselectable=!0)}var j=b.maxDate||b.to;if(j){var k=g(j).endOf(f).unix();e>k&&(d.unselectable=!0)}if(c&&!d.unselectable&&!d.active){if(b.from){var l=g(b.from).startOf(f).unix();e>=l&&c>e&&(d.highlight=!0)}if(b.to){var m=g(b.to).endOf(f).unix();m>=e&&e>c&&(d.highlight=!0)}}},i=function(a,b){return a?(b||(b=moment()),a.hours(b.hours()),a.minutes(b.minutes()),a.seconds(b.seconds()),a):void 0},j={year:function(a,c){var d,g,i=moment().format("YYYY"),j=10*parseInt(moment(a).startOf("year").year()/10,10),k=moment(f(a)).subtract(1,"year").startOf("year");c&&(d=moment(c).year(),g=moment(c).unix());for(var l={currentView:"year",nextView:"year"===b.options.minView?"setValue":"month",previousViewDate:{unselectable:!0,dateValue:null,display:j+"-"+(j+9)},leftDate:{dateValue:moment(k).subtract(9,"year")},rightDate:{dateValue:moment(k).add(11,"year")},dates:[]},m=0;12>m;m+=1){var n=moment(k).add(m,"years"),o={dateValue:n,display:n.format("YYYY"),past:n.year()<j,future:n.year()>j+9,active:!!e.$modelValue&&n.year()===d,isToday:n.format("YYYY")===i};h(n,g,o),l.dates.push(o)}return l},month:function(a,c){var d,f,g=moment().format("YYYY-MM"),i=moment(a).startOf("year");c&&(d=moment(c).format("YYYY-MM"),f=moment(c).unix());for(var j={previousView:"year",currentView:"month",nextView:"month"===b.options.minView?"setValue":"day",previousViewDate:{dateValue:c||moment(),display:i.format("YYYY")},leftDate:{dateValue:moment(i).subtract(1,"year")},rightDate:{dateValue:moment(i).add(1,"year")},dates:[]},k=0;12>k;k+=1){var l=moment(i).add(k,"months"),m=moment(l).format("YYYY-MM"),n={dateValue:l,display:l.format("MMM"),active:!!e.$modelValue&&m===d,isToday:m===g};h(l,f,n),j.dates.push(n)}return j},day:function(a,b){var c,d,e=moment().format("YYYY-MM-DD"),f=moment(a).startOf("month"),g=moment(a).endOf("month");b&&(c=moment(b).format("YYYY-MM-DD"),d=moment(b).unix()),f=i(f,b);for(var j=moment(f).subtract(Math.abs(f.weekday()),"days"),k={previousView:"month",currentView:"day",nextView:"setValue",previousViewDate:{dateValue:b||moment(),display:f.format("YYYY-MMM")},leftDate:{dateValue:moment(f).subtract(1,"months")},rightDate:{dateValue:moment(f).add(1,"months")},dayNames:[],weeks:[]},l=0;7>l;l+=1)k.dayNames.push(moment().weekday(l).format("dd"));for(var m=0;6>m;m+=1){for(var n={dates:[]},o=0;7>o;o+=1){var p=moment(j).add(7*m+o,"days"),q=moment(p).format("YYYY-MM-DD"),r={dateValue:p,display:moment(p).format("D"),active:!!b&&q===c,isToday:q===e,past:p.isBefore(f),future:p.isAfter(g)};h(p,d,r),n.dates.push(r)}k.weeks.push(n)}return k},setValue:function(a){var c;return a&&(moment.isMoment(a)||(a=g(a)),c=a.format(b.options.modelFormat)),e.$setViewValue(c),j[b.options.minView](a,a)}};b.changeView=function(a,c,d){if(d&&(d.stopPropagation(),d.preventDefault()),b.view=a,b.view&&b.view&&!c.unselectable&&j[b.view]&&c.dateValue){var f=g(e.$modelValue);if("setValue"===a&&f&&c.dateValue.unix()===f.unix())return e.$setViewValue(void 0),void e.$render();b.data=j[b.view](c.dateValue,f)}},e.$render=function(){b.view||(b.view=b.options.startView);var a=g(e.$modelValue);b.data=j[b.view](a,a)},d.minDate&&b.$watch("minDate",function(a,b){a!==b&&e.$render()}),d.maxDate&&b.$watch("maxDate",function(a,b){a!==b&&e.$render()}),d.from&&b.$watch("from",function(a,b){a!==b&&e.$render()}),d.to&&b.$watch("to",function(a,b){a!==b&&e.$render()})}}}]),angular.module("ez.datetime").directive("ezDatetimeControl",["EzDatetimeService","$timeout","$uibModal","$parse",function(a,b,c,d){return{restrict:"EA",require:"ngModel",scope:{ngModel:"=",minDate:"=?",maxDate:"=?",from:"=?",to:"=?",config:"=?"},link:function(e,f,g,h){f.addClass("ez-datetime-control"),a.resolveConfig(e,g),h.$formatters.push(function(a){return a?("x"===e.options.modelFormat&&(a=parseInt(a,10)),moment(a).format(e.options.viewFormat)):void 0}),e.clear=function(){e.form.value=void 0},f.bind("click",function(){g.disabled||(e.form={value:h.$modelValue,minDate:e.minDate,maxDate:e.maxDate,from:e.from,to:e.to},c.open({templateUrl:"ez_datetime_modal.html",controller:"EzDatetimeModalController",scope:e}).result.then(function(){e.ngModel=e.form.value,h.$setDirty(),g.ngChange&&b(function(){d(g.ngChange)(e.$parent)})}))})}}}]),angular.module("ez.datetime").directive("ezDatetimeRangeControl",["EzDatetimeService","$parse","$timeout","$uibModal",function(a,b,c,d){return{restrict:"EA",scope:{from:"=",to:"=",shortcut:"=?",minDate:"=?",maxDate:"=?",config:"=?"},link:function(e,f,g){function h(){for(var a=0,b=e.options.shortcuts.length;b>a;a++)if(e.options.shortcuts[a].id===e.shortcut)return e.options.shortcuts[a];return null}var i,j,k=angular.noop,l=angular.noop;if(f.addClass("ez-datetime-control"),a.resolveConfig(e,g),f.is("input")){var m,n;l=function(){"x"===e.options.modelFormat?(m=parseInt(e.from,10),n=parseInt(e.to,10)):(m=e.from,n=e.to),i=m?moment(m).format(e.options.viewFormat):e.options.noValueText,i+=" - ",i+=n?moment(n).format(e.options.viewFormat):e.options.noValueText,f.val(i)},k=function(){l();var a=f.inheritedData("$formController");a.$setDirty()},l()}e.$watch("from",function(a,b){a!==b&&l()}),e.$watch("to",function(a,b){a!==b&&l()}),e.clear=function(){e.form.from=void 0,e.form.to=void 0,e.form.shortcut=void 0},f.bind("click",function(){g.disabled||(e.form={min:e.minDate,max:e.maxDate},e.shortcut?(j=h(e.shortcut),j.from?e.form.from=j.from.format():e.form.from=null,j.to?e.form.to=j.to.format():e.form.to=null,e.form.shortcut=j.id,e.form.shortcutName=j.name):(e.form.from=e.from,e.form.to=e.to),d.open({templateUrl:"ez_datetime_range_modal.html",controller:"EzDatetimeModalController",scope:e}).result.then(function(){(e.form!==e.form.from||e.to!==e.form.to)&&(e.from=e.form.from,e.to=e.form.to,e.shortcut=e.form.shortcut,e.shortcutName=e.form.shortcutName,k(),g.onChange&&c(function(){b(g.onChange)(e.$parent)}))}))})}}}]),angular.module("ez.datetime").directive("ezTimePicker",["EzDatetimeService",function(a){return{restrict:"EA",require:"ngModel",templateUrl:"ez_datetime_time_picker.html",scope:{ngModel:"=",options:"=?"},link:function(b,c,d,e){function f(){b.data={minuteStep:15,secondStep:15,hours:[],minutes:[],seconds:[]},g()}function g(){if(b.data.minutes=[],b.data.seconds=[],!b.data.hours.length)for(var a=b.options.meridiemEnabled?1:0,c=b.options.meridiemEnabled?12:23;c>=a;)b.data.hours.push(a),a+=1;for(var d=0;60>d;)b.data.minutes.push(d),d+=b.data.minuteStep;for(var e=0;60>e;)b.data.seconds.push(e),e+=b.data.secondStep}function h(a){e.$setViewValue(a.format(b.options.modelFormat)),e.$render()}function i(){return b.ngModel?"x"===b.options.modelFormat?moment(parseInt(b.ngModel,10)):moment(b.ngModel):void 0}a.resolveConfig(b,d),b.setHour=function(a){var b=i();b&&(b.hours(a),h(b))},b.setMinute=function(a){var b=i();b&&(b.minutes(a),h(b))},b.setSecond=function(a){var b=i();b&&(b.seconds(a),h(b))},b.toggleMeridiem=function(){var a=i();a&&(a.hours()>12?a.hours(a.hours()-12):a.hours(a.hours()+12),h(a))},b.increaseMinuteStep=function(a){switch(a.preventDefault(),a.stopPropagation(),b.data.minuteStep){case 15:b.data.minuteStep=5;break;case 5:b.data.minuteStep=1}g()},b.increaseSecondStep=function(a){switch(a.preventDefault(),a.stopPropagation(),b.data.secondStep){case 15:b.data.secondStep=5;break;case 5:b.data.secondStep=1}g()},f()}}}]),angular.module("ez.datetime").filter("ezDateAgo",["EzDatetimeConfig",function(a){return function(b,c){return b?(c||(c=a.viewFormat),isNaN(b)||(b=parseInt(b,10)),moment().diff(moment(b),"h")<24?moment(b).fromNow():moment(b).format(c)):void 0}}]),angular.module("ez.datetime").filter("ezDate",["EzDatetimeConfig",function(a){return function(b,c,d){return b?(void 0===c&&(c=a.viewFormat),void 0===d&&(d=a.isUtc),moment.isMoment(b)?b.format(c):(isNaN(b)||(b=parseInt(b,10)),d?moment.utc(b).format(c):moment(b).format(c))):void 0}}]),angular.module("ez.datetime").filter("ezDatetimeShortcut",["EzDatetimeConfig",function(a){return function(b){if(!b)return"";for(var c=0,d=a.shortcuts.length;d>c;c++)if(a.shortcuts[c].id===b)return a.shortcuts[c].name;return""}}]),angular.module("ez.datetime").service("EzDatetimeService",["$parse","EzDatetimeConfig",function(a,b){return{resolveConfig:function(c,d){if(d.options)return c.options;c.options=angular.extend({},b,c.config);for(var e in b)d.hasOwnProperty(e)&&("boolean"==typeof b[e]?c.options[e]=a(d[e])(c.$parent):c.options[e]=d[e])}}}]);
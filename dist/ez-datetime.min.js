angular.module("ez.datetime",[]),angular.module("ez.datetime").constant("EzDatetimeConfig",{minView:"day",startView:"day",modelFormat:void 0,viewFormat:"MMM Do YYYY [at] h:mma",modelBinding:"default",timepickerEnabled:!0,secondsEnabled:!1,meridiemEnabled:!0,hourStep:1,minuteStep:15,secondStep:15,hourFormat:"h",minuteFormat:"mm",secondFormat:"ss",meridiemFormat:"A",heading:"Select a Date",rangeHeading:"Select a Start & End Date",okBtnText:"OK",cancelBtnText:"Cancel"}),angular.module("ez.datetime").controller("EzDatetimeModalController",["$scope","$modalInstance",function(a,b){a.dismiss=function(){b.dismiss()},a.ok=function(){b.close()}}]),angular.module("ez.datetime").directive("ezDatePicker",["EzDatetimeConfigService",function(a){return{restrict:"EA",require:"ngModel",templateUrl:"ez_datetime_date_picker.html",scope:{from:"=?",to:"=?",options:"=?"},replace:!0,link:function(b,c,d,e){b.date=null,a.resolve(b,d);var f=function(a){var b=10*parseInt(moment(a).year()/10,10);return moment(a).year(b).startOf("year")},g=function(a,c,e){var f;if(d.from&&b.from){f=moment(a).unix();var g=moment(b.from).unix();c&&f>=g&&c>f&&(e.highlight=!0),g>f&&(e.unselectable=!0)}else if(d.to&&b.to){f=moment(a).unix();var h=moment(b.to).unix();c&&h>=f&&f>c&&(e.highlight=!0),f>h&&(e.unselectable=!0)}},h={year:function(a){for(var c=moment().format("YYYY"),d=moment(a).startOf("year"),h=10*parseInt(d.year()/10,10),i=moment(f(a)).subtract(1,"year").startOf("year"),j=moment(e.$viewValue).year(),k=moment(e.$viewValue).unix(),l={currentView:"year",nextView:"year"===b.options.minView?"setTime":"month",previousViewDate:{unselectable:!0,dateValue:null,display:h+"-"+(h+9)},leftDate:{dateValue:moment(i).subtract(9,"year").valueOf()},rightDate:{dateValue:moment(i).add(11,"year").valueOf()},dates:[]},m=0;12>m;m+=1){var n=moment(i).add(m,"years"),o={dateValue:n,display:n.format("YYYY"),past:n.year()<h,future:n.year()>h+9,active:!!e.$viewValue&&n.year()===j,current:n.format("YYYY")===c};g(n,k,o),l.dates.push(o)}return l},month:function(a){for(var c=moment().format("YYYY-MMM"),d=moment(a).startOf("year"),h=f(a),i=moment(e.$viewValue).format("YYYY-MMM"),j=moment(e.$viewValue).unix(),k={previousView:"year",currentView:"month",nextView:"month"===b.options.minView?"setTime":"day",previousViewDate:{dateValue:h.valueOf(),display:d.format("YYYY")},leftDate:{dateValue:moment(d).subtract(1,"year").valueOf()},rightDate:{dateValue:moment(d).add(1,"year").valueOf()},dates:[]},l=0;12>l;l+=1){var m=moment(d).add(l,"months"),n={dateValue:m,display:m.format("MMM"),active:!!e.$viewValue&&m.format("YYYY-MMM")===i,current:m.format("YYYY-MMM")===c};g(m,j,n),k.dates.push(n)}return k},day:function(a){var c=a,d=moment().format("YYYY-MMM-DD"),f=moment(c).startOf("month");if(b.options.timepickerEnabled){var h=moment(e.$viewValue);f.hours(h.hours()),f.minutes(h.minutes()),f.seconds(h.seconds())}for(var i=moment(c).startOf("year"),j=moment(c).endOf("month"),k=moment(f).subtract(Math.abs(f.weekday()),"days"),l=moment(e.$viewValue).format("YYYY-MMM-DD"),m=moment(e.$viewValue).unix(),n={previousView:"month",currentView:"day",nextView:"setTime",previousViewDate:{dateValue:i.valueOf(),display:f.format("YYYY-MMM")},leftDate:{dateValue:moment(f).subtract(1,"months").valueOf()},rightDate:{dateValue:moment(f).add(1,"months").valueOf()},dayNames:[],weeks:[]},o=0;7>o;o+=1)n.dayNames.push(moment().weekday(o).format("dd"));for(var p=0;6>p;p+=1){for(var q={dates:[]},r=0;7>r;r+=1){var s=moment(k).add(7*p+r,"days"),t={dateValue:s,display:s.format("D"),active:!!e.$viewValue&&s.format("YYYY-MMM-DD")===l,current:!e.$viewValue&&s.format("YYYY-MMM-DD")===d,past:s.isBefore(f),future:s.isAfter(j)};g(s,m,t),q.dates.push(t)}n.weeks.push(q)}return n},setTime:function(a){return"string"==typeof a&&(a=moment(a)),e.$setViewValue(moment(a).format(b.options.modelFormat)),e.$render(),h[b.options.minView](a)}};b.changeView=function(a,c,d){d&&(d.stopPropagation(),d.preventDefault()),b.view=a,b.view&&b.view&&!c.unselectable&&h[b.view]&&c.dateValue&&(b.data=h[b.view](c.dateValue))},e.$render=function(){b.view||(b.view=b.options.startView,b.data=h[b.view](e.$viewValue))},d.from&&b.$watch("from",function(a,c){a!==c&&b.changeView(b.view,{dateValue:e.$viewValue})}),d.to&&b.$watch("to",function(a,c){a!==c&&b.changeView(b.view,{dateValue:e.$viewValue})})}}}]),angular.module("ez.datetime").directive("ezDatetimeControl",["EzDatetimeConfigService","$modal",function(a,b){return{restrict:"EA",require:"ngModel",scope:{ngModel:"=",from:"=?",to:"=?",config:"=?"},link:function(c,d,e,f){var g=!1;c.form={},d.addClass("ez-datetime-control"),a.resolve(c,e),e.from&&e.to&&(g=!0),f.$formatters.push(function(a){return a&&(a=g&&"default"===c.options.modelBinding?moment(a.from).format(c.options.viewFormat)+" - "+moment(a.to).format(c.options.viewFormat):moment(a).format(c.options.viewFormat)),a}),d.bind("click",function(){c.form.date=f.$modelValue,c.form.date&&(c.form.date.from&&(c.form.from=c.form.date.from),c.form.date.to&&(c.form.to=c.form.date.to)),c.form.from=c.from,c.form.to=c.to,c.form.isFrom=!!e.to&&!!c.form.to,c.form.isTo=!!e.from&&!!c.form.from,c.form.from||c.from||(c.form.from=moment().format(c.options.modelFormat)),c.form.to||c.to||(c.form.to=moment().format(c.options.modelFormat)),b.open({templateUrl:g?"ez_datetime_range_modal.html":"ez_datetime_modal.html",controller:"EzDatetimeModalController",scope:c}).result.then(function(){if(c.from=c.form.from,c.to=c.form.to,g)switch(c.options.modelBinding){case"default":c.ngModel={from:c.from,to:c.to};break;case"from":c.ngModel=c.from;break;case"to":c.ngModel=c.to}else c.ngModel=c.form.date;f.$setDirty()})})}}}]),angular.module("ez.datetime").directive("ezTimePicker",["EzDatetimeConfigService",function(a){return{restrict:"EA",require:"ngModel",templateUrl:"ez_datetime_time_picker.html",scope:{ngModel:"=",options:"=?"},link:function(b,c,d,e){function f(){b.data={hours:[],minutes:[],seconds:[]};for(var a=b.options.meridiemEnabled?1:0,c=b.options.meridiemEnabled?12:23;c>=a;)b.data.hours.push(a),a+=b.options.hourStep;for(var d=0;60>=d;)b.data.minutes.push(d),d+=b.options.minuteStep;for(var f=0;60>=f;)b.data.seconds.push(f),f+=b.options.secondStep;e.$render=function(){e.$viewValue||(b.ngModel=moment().format(b.options.modelFormat))}}function g(a){e.$setViewValue(a.format(b.options.modelFormat)),e.$render()}a.resolve(b,d),b.setHour=function(a){var c=moment(b.ngModel);c.hours(a),g(c)},b.setMinute=function(a){var c=moment(b.ngModel);c.minutes(a),g(c)},b.setSecond=function(a){var c=moment(b.ngModel);c.seconds(a),g(c)},b.toggleMeridiem=function(){var a=moment(b.ngModel);a.hours(a.hours()>12?a.hours()-12:a.hours()+12),g(a)},f()}}}]),angular.module("ez.datetime").filter("ezDate",[function(){return function(a,b){return a?moment(a).format(b):void 0}}]),angular.module("ez.datetime").service("EzDatetimeConfigService",["$parse","EzDatetimeConfig",function(a,b){return{resolve:function(c,d){if(d.options)return c.options;c.options=angular.extend({},b,c.config);for(var e in b)d.hasOwnProperty(e)&&(c.options[e]="boolean"==typeof b[e]?a(d[e])(c.$parent):d[e])}}}]);